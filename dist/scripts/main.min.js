function neighborhoodMapViewModel(){function o(o,e){var n=document.createElement("div");n.className="reset-button",n.title="Click to recenter the map",o.appendChild(n);var t=document.createElement("div");t.className="reset-button-text",t.innerHTML="Reset Kapahulu Map",n.appendChild(t),google.maps.event.addDomListener(n,"click",function(){e.setCenter(m),e.setZoom(16),googleinfowin&&googleinfowin.close(),l.query("")})}function e(){map=new google.maps.Map(c,u),t(),map.controls[google.maps.ControlPosition.TOP_RIGHT].push(l.list);{var e=document.createElement("div");new o(e,map)}e.index=1,map.controls[google.maps.ControlPosition.BOTTOM_CENTER].push(e),map.controls[google.maps.ControlPosition.TOP_LEFT].push(p);var i=window.setTimeout(n,8e3);google.maps.event.addListener(map,"tilesloaded",function(){window.clearTimeout(i)}),google.maps.event.addListener(map,"click",function(){googleinfowin.close()})}function n(){$("#map-canvas").html("<h1>Google Maps Failed to Load. Please try reloading the page.</h1>")}function t(){var o={location:m,radius:500,types:["restaurant","cafe","food"]};googleinfowin=new google.maps.InfoWindow,s=new google.maps.places.PlacesService(map),s.nearbySearch(o,i)}function i(o,e){if(e==google.maps.places.PlacesServiceStatus.OK){results=o.slice(0,16);var n=window.mapBounds;results.forEach(function(o){var e=o.geometry.location.lat(),t=o.geometry.location.lng(),i=results.indexOf(o),a=new Pin(map,o.name,e,t,o.place_id,i);n.extend(new google.maps.LatLng(r,g)),l.pins.push(a)}),console.log(fsidArray),map.fitBounds(n),map.setCenter(n.getCenter())}}function a(o){var e=fsidArray[o],n="http://api.foursquare.com/v2/venues/"+e+"?oauth_token=GQDPA05ROIS0UO5KO3YQEW4KGYBC2QOW1PCKD0HMQR5COFVH&v=20150830&m=foursquare&format=json";$.getJSON(n,function(o){console.log(e)}).error(function(o){console.log("oops")})}var s,l=this,r=21.2790587,g=-157.81368810000004,m=new google.maps.LatLng(r,g);l.pins=ko.observableArray([]),l.query=ko.observable(""),l.foursquareInfo="",l.list=document.getElementById("list");var p=document.getElementById("pac-input"),c=document.getElementById("map-canvas"),u={zoom:16,maxZoom:16,minZoom:10,center:m,disableDefaultUI:!0,zoomControl:!0,zoomControlOptions:{style:google.maps.ZoomControlStyle.LARGE,position:google.maps.ControlPosition.LEFT_TOP},scaleControl:!0,streetViewControl:!0,streetViewControlOptions:{position:google.maps.ControlPosition.LEFT_TOP}};l.filterPins=ko.computed(function(){var o=l.query().toLowerCase();return ko.utils.arrayFilter(l.pins(),function(e){var n=e.googlename().toLowerCase().indexOf(o)>=0;return e.isVisible(n),n})}),l.clickMarker=function(o){a(o.fsqArrayPos());var e=new google.maps.LatLng(o.lat(),o.lon()),n=o.marker();map.panTo(e),googleinfowin&&googleinfowin.close(),setTimeout(function(){var e=o.googlename()+"<br>4sq: ",t=document.createElement("div");t.innerHTML=e,googleinfowin.setContent(t),googleinfowin.open(map,n),n.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){n.setAnimation(null)},1e3)},500)},google.maps.event.addDomListener(window,"load",e),window.mapBounds=new google.maps.LatLngBounds,window.addEventListener("resize",function(o){map.fitBounds(mapBounds)})}var map,fsidArray=[],googleinfowin,Pin=function(o,e,n,t,i,a){function s(o){fsidArray.push(o.response.venues[0].id)}var l,r=this;r.fsqid=ko.observable(""),r.googlename=ko.observable(e),r.lat=ko.observable(n),r.lon=ko.observable(t),r.fsqArrayPos=ko.observable(a),l=new google.maps.Marker({icon:"img/red-dot.png",position:new google.maps.LatLng(n,t),place_id:i}),r.marker=ko.observable(l),r.isVisible=ko.observable(!1),r.isVisible.subscribe(function(e){l.setMap(e?o:null)}),r.isVisible(!0),function(){var o="http://api.foursquare.com/v2/venues/search?ll="+n+","+t+"&oauth_token=GQDPA05ROIS0UO5KO3YQEW4KGYBC2QOW1PCKD0HMQR5COFVH&v=20150830&m=foursquare&format=json&limit=1";$.getJSON(o,function(o){s(o)}).error(function(o){console.log("oops")})}(),google.maps.event.addListener(l,"click",function(){var e=r.googlename();googleinfowin&&googleinfowin.close(),googleinfowin.setContent(e),googleinfowin.open(o,l),o.panTo(l.position),l.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){l.setAnimation(null)},1e3)})};ko.applyBindings(new neighborhoodMapViewModel);