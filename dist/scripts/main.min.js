function neighborhoodMapViewModel(){function e(){var e=c.getCenter();u=e.lat(),p=e.lng()}function o(e,o){var t=document.createElement("div");t.className="reset-button",t.title="Click to recenter the map",e.appendChild(t);var n=document.createElement("div");n.className="reset-button-text",n.innerHTML="Center Map",t.appendChild(n),google.maps.event.addDomListener(t,"click",function(){o.setCenter(v)})}function t(){c=new google.maps.Map(b,w),a(),e(),m.getFoursquareInfo();{var t=document.createElement("div");new o(t,c)}t.index=1,c.controls[google.maps.ControlPosition.LEFT_BOTTOM].push(t);var i=document.getElementById("list");c.controls[google.maps.ControlPosition.TOP_RIGHT].push(i);var s=document.getElementById("pac-input");c.controls[google.maps.ControlPosition.TOP_LEFT].push(s);var r=new google.maps.places.SearchBox(s);google.maps.event.addListener(r,"places_changed",function(){var o=r.getPlaces();l(),m.allPlaces.removeAll();for(var t,n=new google.maps.LatLngBounds,a=0;10>a;a++)if(void 0!==o[a]){t=o[a];{new h(c,t.name,t.geometry.location.lat(),t.geometry.location.lng(),t.place_id,t.text)}n.extend(t.geometry.location)}c.fitBounds(n),e()}),google.maps.event.addListener(c,"bounds_changed",function(){var e=c.getBounds();r.setBounds(e)});var d=window.setTimeout(n,5e3);google.maps.event.addListener(c,"tilesloaded",function(){window.clearTimeout(d)})}function n(){$("#map-canvas").html("<h1>Google Maps Failed to Load. Please try reloading the page.</h1>")}function a(){var e={location:v,radius:700,types:["meal_takeaway","restaurant","bar","cafe","food"]},o={location:v,radius:700,types:["meal_takeaway","restaurant","bar","cafe","food"],query:"restaurant"};g=new google.maps.InfoWindow,d=new google.maps.places.PlacesService(c),d.nearbySearch(e,i),d.textSearch(o,i)}function i(e,o){o==google.maps.places.PlacesServiceStatus.OK&&(bounds=new google.maps.LatLngBounds,e.forEach(function(e){{var o=e.geometry.location.lat(),t=e.geometry.location.lng();new h(c,e.name,o,t,e.place_id,e.text)}bounds.extend(new google.maps.LatLng(o,t))}),c.fitBounds(bounds),e.forEach(r))}function s(e,o){var t=ko.observable();return ko.computed(function(){e.call(o).done(t)}),t}function r(e){var o={};o.place_id=e.place_id,o.position=e.geometry.location.toString(),o.name=e.name;var t;void 0!==e.vicinity?t=e.vicinity:void 0!==e.formatted_address&&(t=e.formatted_address),o.address=t,m.pins=[],m.allPlaces.push(o)}function l(){for(var e=0;e<f.length;e++)f[e].setMap(null);f.length=0}var c,d,g,m=this,u=21.2790587,p=-157.81368810000004,v=new google.maps.LatLng(u,p),f=[];m.pins=ko.observableArray([]),m.allPlaces=ko.observableArray([]),m.foursquareInfo="",m.query=ko.observable(""),m.filterPins=ko.computed(function(){var e=m.query().toLowerCase();return ko.utils.arrayFilter(m.pins(),function(o){var t=o.name().toLowerCase().indexOf(e)>=0;return o.isVisible(t),t})});var h=function(e,o,t,n,a,i){var s;this.name=ko.observable(o),this.lat=ko.observable(t),this.lon=ko.observable(n),this.text=ko.observable(i),s=new google.maps.Marker({icon:"http://maps.google.com/mapfiles/ms/icons/red-dot.png",position:new google.maps.LatLng(t,n),place_id:a,animation:google.maps.Animation.DROP}),this.isVisible=ko.observable(!1),this.isVisible.subscribe(function(o){s.setMap(o?e:null)}),this.isVisible(!0)},b=document.getElementById("map-canvas"),w={zoom:13,maxZoom:18,minZoom:9,center:v,disableDefaultUI:!0,zoomControl:!0,zoomControlOptions:{style:google.maps.ZoomControlStyle.LARGE,position:google.maps.ControlPosition.LEFT_TOP},scaleControl:!0,streetViewControl:!0,streetViewControlOptions:{position:google.maps.ControlPosition.LEFT_TOP}};this.getFoursquareInfo=s(function(){var e="http://api.foursquare.com/v2/venues/search?ll="+u+","+p+"&oauth_token=GQDPA05ROIS0UO5KO3YQEW4KGYBC2QOW1PCKD0HMQR5COFVH&v=20150830&m=foursquare";return $.getJSON(e,{format:"json"})},this),m.clickMarker=function(e){for(var o,t=0;t<f.length;t++)if(e.place_id===f[t].place_id){o=f[t];break}c.panTo(o.position);var n='<div style="font-weight: bold">'+e.name+"</div><div>"+e.address+"</div>"+m.foursquareInfo;g.setContent(n),g.open(c,o),o.setAnimation(google.maps.Animation.DROP)},google.maps.event.addDomListener(window,"load",t)}ko.applyBindings(new neighborhoodMapViewModel);